---
title: "An investigation into the spread of Kiva loans around the world"
author: "Antriksh - 510415022 | Boris - 500463613 | Vishesh - 500545399 | Alex - 500459111"
subtitle: "For MATH1115: Project 1"
date: "University of Sydney | January 2022"
bibliography: references.bib
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    #This will allow you to insert icons in your document, thanks to [Font Awesome](http://fontawesome.io).
    toc: true
    toc_depth: 3
    toc_float: true
    code_folding: hide
---

<br>

# Executive Summary

Clear, interesting summary of the main insights from the report. [Max 100 words].

<br>

# Full Report

```{r}
library(tidyverse)
library(janitor)
library(plotly)
library(gt)
```

## Initial Data Analysis (IDA)

 - Origin of data reviewed and critically assessed incl reliability and limitations
  - Kiva Data (~ 100 words)
  - World Data (~50)
 - Data wrangling necessary and rational (~75)
 - Potential interested stakeholders (~75)

The GDP data set used in research question one is from the World Bank, it currently contains global annual GDP data for 266 countries from as early as 1960 (depending on the country) to 2021. The data itself is reliable as it is collected and consolidated by the world bank, which is a global organisation run by the United Nations. The onyl limitation is some of the country names don't exactyl match the ones in the kiva dataset. 

https://data.worldbank.org/indicator/NY.GDP.MKTP.CD?fbclid=IwAR29u5holItcdJImridwqJs2rhiEvhytJR35XB6dSAoYRqIRUEJ9MEfDtRo

## Data setup

```{r}
kiva_loans <- read_csv("data/kiva_loans.csv") # read in Kiva data
```

Let's create our own country dataset.

Sources: 
- https://www.kaggle.com/datasets/juanumusic/countries-iso-codes
- https://ourworldindata.org/grapher/gross-domestic-product 

NEED TO ELABORATE ON THESE SOURCES...

```{r}
# Creating our own 'Countries' dataset from two other datasets
countries <- read_csv("data/countries.csv")
countries_clean <- countries %>%
  clean_names() %>%
  subset(select = c("country", "region", "population", "pop_density_per_sq_mi", 
                    "infant_mortality_per_1000_births", "gdp_per_capita", "literacy_percent",
                    "phones_per_1000", "arable_percent", "crops_percent"))

iso_codes <- read_csv("data/iso_codes.csv") %>%
  rename(name = `English short name lower case`) %>%
  rename(country_code = `Alpha-2 code`) %>%
  subset(select = c("name", "country_code")) # only need the 3-digit code

iso_countries <- merge(countries_clean, iso_codes, by.x = "country", by.y = "name")
head(iso_countries)
```

```{r}
# Merging Countries dataset with Kiva loans

kiva_countries <- merge(kiva_loans, iso_countries, by.x = "country_code", by.y = "country_code")
```


## IQ 1: Is there a correlation between a country's GDP and the total sum of Kiva loans? (Boris)

To answer this question an interactive scatter plot was created using the below code. Hovering above a data point will bring up the country's name, its GDP and its total loan sum. Both axis are logarithmic with a base of 10 in order to spread out the data.

```{r, warning = FALSE, message = FALSE}
kiva_gdp <- kiva_countries %>%
  group_by(country.x, gdp_per_capita) %>%
  summarise(total_loans = sum(loan_amount))

plot_kiva_gdp <- ggplot(kiva_gdp, aes(x = `gdp_per_capita`, y = `total_loans`, country = `country.x`)) +
  geom_point(colour  = "darkgreen") + 
  scale_x_continuous(trans = 'log10') +
  scale_y_continuous(trans = 'log10') +
  labs(x = "GDP (USD)", y = "Sum of Loans (USD)", title = "Exponetial Scatter plot for the Sum of Kiva loans against the GDP for each Country")
ggplotly(plot_kiva_gdp)
```

The GDP data in the scatter plot above is made up of GDP data from 2015. This was done to make a better comparison with the kiva loan data which has data from 2013 to 2017. GDP and Loan Sum appear to have a slight negative correlation with countries with a relatively low accounting for the majority of loaned money.

## IQ 2: What is the distribution of funding between the Kiva designated sectors?

```{r}
loan_data %>%
  group_by(sector) %>%
  summarise(total_funding = signif(sum(funded_amount)*10^(-6),5)) %>%
  ggplot(aes(x=fct_reorder(sector, desc(total_funding)), y = total_funding)) + geom_col() +  # Represents the data as a side by side bar chart with colour
  labs(x = "Sector", y = "Total Funding (Million USD)", title = 'Total Kiva funding per Sector') +
  theme_classic() + #Classic theme just an example or an idea of what can be done and how
  geom_text(aes(label = total_funding), vjust = -0.5, size = 2) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust=0.4))
```

Reviewing the above bar plot, we can see that agriculture, food and retail are by far the most funded Kiva sectors. For context, these three sectors receive double the amount of funding as the remaining 12. Interestingly, if we review the ‘Use’ column of the data frame it can also be observed that many loans categorised for retail are in fact loans to purchase food items such as Salt, Rice, Flour etc.

```{r}
loan_data %>%
  filter(sector == 'Food') %>%
  select(use) %>%
  slice(1:10) %>% 
  gt()

```

The conclusions drawn from research Q1 inform us that Kiva loans are most typically requested in developing countries with low GDP’s, in these countries access to food is not a given and the creation of a constant food supply may be able to lift some out of poverty. In his 2015 report, Robert Townsend states that for the worlds poorest, growth in agriculture is two to four times more effective in raising living standards than growth in the next closest sector. This fact can create a win-win scenario for all stakeholders. So long as the loan is used wisely the fundees can create more value than they initially borrowed, and funders can see their investment amount to more than its dollar value. As such, it is not surprising that agriculture loans make up 27% of all Kiva loans.  

This will need to be formatted properly 

Townsend, R. (2015). Ending poverty and hunger by 2030 : an agenda for the global food system. Washington DC. Retrieved from https://documents.worldbank.org/en/publication/documents-reports/documentdetail/700061468334490682/ending-poverty-and-hunger-by-2030-an-agenda-for-the-global-food-system. 

## IQ 3: A deeper look into the agriculture sector

As most Kiva funding went towards agriculture-related activities (as found by IQ 2), it may be interesting to explore this sector further.

```{r}
# filtering all agriculture-related Kiva loans 
agriculture_loans <- kiva_loans[kiva_loans["sector"] == "Agriculture", ]
head(agriculture_loans)
```

Let's explore where most of these agriculture-related loans are going.

```{r}
# Merging with agriculture loans
kiva_countries <- merge(agriculture_loans, iso_countries, by.x = "country_code", by.y = "country_code")

# Grouping agriculture loans by region
agriculture_by_region <- kiva_countries %>% 
  group_by(region.y) %>%
  summarise(sum(loan_amount))
```

<br>

# References

Style: APA 

<br>
