---
title: "MATH1115: Project 1"
author: "Antriksh - 510415022 | Boris - 500463613 | Vishesh - 500545399 | Alex - 500459111"
subtitle: "An investigation into Kiva crowdfunding data"
date: "University of Sydney | MATH1115 | JAN 2023"
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    toc: true
    toc_depth: 3
    toc_float: true
    code_folding: hide
---

<br>

# Executive Summary
- The aim of this report is to ...
- The main discoveries are ...

<br>

# Full Report

## Initial Data Analysis (IDA)

The data set used to generate our research questions comes from the Kiva Crowdfunding, ‘Data science for good’ open data initiative. Kiva (2023) is a service aimed at providing small loans to the worlds unbanked population. This initiative was created so members of the public could help Kiva better understand the levels of poverty in areas where they had active loans (Kaggle, 2018). The data has a CC0: Public Domain licence meaning that we are free to use and distribute the data as we wish (Creative Commons, 2023) The data has been edited by a community member called ‘mfab’ which may reduce the reliability of the data, however as Kiva is the ‘Owner’ it is assumed that they have approved this editor and that the data remains reliable. The omission of the COVID-19 pandemic from the data is a notable limitation as the pandemic may have created changes in trends which would have made for interesting research. 

The world_gdp data is reliable as it is collected and consolidated by the world bank, which is a global organisation run by the United Nations. It has a CC-BY 4.0 license allowing users to copy, modify and distribute data in any format for any purpose (World Bank, 2021). Some wrangling of data was required in order to generate plots utilising the datasets. Most of the wrangling involved grouping to isolate variables for comparison. Functions such as mutate, rename and merge were also used to change variable values, rename columns and merge datasets together for the generation of our figures. Potential stakeholders for this report would be those looking to potentially loan out money to others through services like Kiva, that want to know where their money is being sent and how it is being used.  

## Data setup

```{r, message=FALSE, warning=FALSE}
library(tidyverse)
library(tmap)
library(countrycode)
library(janitor)
library(plotly)
```

```{r, message=FALSE, warning=FALSE}
# Kiva loans dataset
kiva_loans <- read_csv("data/kiva_loans.csv")

# Two supplementary Kiva datasets surrounding loan themes and id's
kiva_loan_ids <- read_csv("data/loan_theme_ids.csv")
kiva_loan_regions <- read_csv("data/loan_themes_by_region.csv")

# World Bank GDP dataset
world_gdp <- read_csv("data/world_gdp.csv", skip = 4) 
```

However, before we begin our geographical analysis on the distribution of Kiva agricultural loans around the world, we first need to setup our data. The Kiva loans datasets have been set up with two primary keys: `id` and `Loan theme ID`. The dataset has been normalised such that if we merge `kiva_loan_ids` with `kiva_loan_regions` we will be able to extract the ISO code related to each loan, which in combination with the `tmap` package will provide us with the geographical data we want.

```{r}
kiva_loan_ids_subset <- kiva_loan_ids %>%
  select(c("id", "Loan Theme ID")) %>%
  rename(loan_theme_id = `Loan Theme ID`)

kiva_loan_regions_subset <- kiva_loan_regions %>%
  select(c("Loan Theme ID", "country", "ISO")) %>%
  rename(iso = ISO,
         loan_theme_id = `Loan Theme ID`)
kiva_loan_regions_subset <- kiva_loan_regions_subset[!duplicated(kiva_loan_regions_subset), ] # remove duplicates

# Perform merge
kiva_loans_themeid <- inner_join(kiva_loans, kiva_loan_ids_subset, by = "id")
kiva_loans_PKs <- inner_join(kiva_loans_themeid, kiva_loan_regions_subset, by = c("country", "loan_theme_id"))
```

Note that in the code above we performed an inner join between all three datasets. Due to the presence of NA's and missing data, this process will inevitably cause some data loss. In our case, we lost approximately 30000 rows of data ($~4\%$ of the original dataset). We deem that working with a complete dataset (with no missing loan theme id's or ISO's) is enough to justify this small loss in data.

```{r}
# Checking for any null values in the two columns of importance
is.null(kiva_loans_PKs$iso)
is.null(kiva_loans_PKs$loan_theme_id)
```

## IQ 1: Is there a correlation between a country's GDP per capita and its total loan sum?

To answer this question an interactive scatter plot was produces using the below code. Hovering above a data point will bring up the country's name, its GDP per capita and its total loan sum. Both axis are logarithmic with a base of 10 in order to spread out the data so relationships can be drawn.

```{r, warning = FALSE, message = FALSE}
# Combining the world_gdp data with the ISO codes kiva dataset in order to merge the country names
kiva_sum <- kiva_loans %>%
  group_by(country) %>%
  summarise(signif(sum(loan_amount)*10^(-6),5))

gdp_cleaned <- world_gdp %>% 
  rename(country = "Country Name") %>% # renames country
  mutate(country = recode(country, `Congo, Rep.` = "Congo", `Congo, Dem. Rep.` = "The Democratic Republic of the Congo", `Cote d'Ivoire` = "Cote D'Ivoire", `Egypt, Arab Rep.` = "Egypt", `Kyrgyz Republic` = "Kyrgyzstan", `Lao PDR` = "Lao People's Democratic Republic", `Myanmar` = "Myanmar (Burma)", `West Bank and Gaza` = "Palestine", `St. Vincent and the Grenadines` = "Saint Vincent and the Grenadines", `Turks and Caicos Islands` = "Turkey", `Virgin Islands (U.S.)` = "Virgin Islands", `Yemen, Rep.` = "Yemen")) %>% # renames country names that differ from the kiva data set %>% 
  group_by(country) %>% # aggregates by country
  rename(country_gdp = "2015") %>% # renames country GDP
  summarise(country_gdp) # creates a new data frame

kiva_gdp <- merge(kiva_sum, gdp_cleaned, all.x = T, all.y = F) # merges the two data frames

colnames(kiva_gdp) <- c("Country", "Loan Sum (Million USD)", "GDP per Capita (USD)")

plot_kiva_gdp <- ggplot(kiva_gdp, aes(x = `GDP per Capita (USD)`, y = `Loan Sum (Million USD)`, country = `Country`)) +
  geom_point(colour  = "black") + 
  scale_x_continuous(trans = 'log10') +
  scale_y_continuous(trans = 'log10') +
  labs(x = "GDP per capita (USD)", y = "Loan Sum (Million USD)", title = "The total sum of Kiva loans against the GDP per capita for each country")
ggplotly(plot_kiva_gdp)
```

The GDP data in the scatter plot above utilities the GDP data from 2015. This was done to make a better comparison with the kiva loan data which has data from 2014 to 2017. The plot has clustering in the top left, which implies that countries with a lower GDP per capita account for the majority of loaned money. There is however no direct linear correlation between the total loaned amount and GDP per capita. It is important to note that the countries that with the highest total loan sum tend to be developing countries with a relatively low GDP per capita. Agriculture tends to be the largest sector in terms of their shares in GDP and employment for these sorts of countries (https://citeseerx.ist.psu.edu/document?repid=rep1&type=pdf&doi=7d15e1f8e20c97dd4eeeccd2ad3f5e3e4255b831#:~:text=Agricultural%20Spending,shares%20in%20GDP%20and%20employment.). Which is interesting to note as it leads into IQ 2 which looks into how the funding is distributed per sector. 

## IQ 2: What is the distribution of funding between the Kiva designated sectors?

```{r}
 kiva_loans %>%
  group_by(sector) %>%
  summarise(total_funding = signif(sum(funded_amount)*10^(-6),5)) %>%
  ggplot(aes(x=fct_reorder(sector, desc(total_funding)), y = total_funding)) + geom_col(fill = "black") +  # Represents the data as a side by side bar chart with colour
  labs(x = "Sectors", y = "Total Funding (Million USD)", title = 'Total Kiva funding per sector') +
  theme_classic() + #Classic theme just an example or an idea of what can be done and how
  geom_text(aes(label = total_funding), vjust = -0.5, size = 2) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust=0.4))
```

Reviewing the above bar plot, we can see that agriculture, food and retail are by far the most funded Kiva sectors. For context, these three sectors received twice the amount of funding than the remaining 12. Interestingly, if we review the ‘Use’ column of the data frame it can also be observed that many loans categorised for retail are in fact loans to purchase food items such as Salt, Rice, Flour etc.

```{r}
library(gt)
kiva_loans %>%
  filter(sector == 'Food') %>%
  select(use) %>%
  slice(1:10) %>% 
  gt()
```

The conclusions drawn from IQ 1 inform us that Kiva loans are most typically requested in developing countries with low GDP’s, in these countries access to food is not a given and the creation of a constant food supply may be able to lift some out of poverty. In his 2015 report, Robert Townsend states that for the worlds poorest, growth in agriculture is two to four times more effective in raising living standards than growth in the next closest sector. This fact can create a win-win scenario for all stakeholders. So long as the loan is used wisely the fundees can create more value than they initially borrowed, and funders can see their investment amount to more than its dollar value. As such, it is not surprising that agriculture loans make up 27% of all Kiva loans.  

This will need to be formatted properly 

Townsend, R. (2015). Ending poverty and hunger by 2030 : an agenda for the global food system. Washington DC. Retrieved from https://documents.worldbank.org/en/publication/documents-reports/documentdetail/700061468334490682/ending-poverty-and-hunger-by-2030-an-agenda-for-the-global-food-system. 

## IQ 3: Which parts of the world do agriculture-related loans go to?

As was uncovered in IQ 2, most of Kiva funding goes towards agriculture-related loans. This inquiry question will attempt to discover where these loans are ending up in the world.

Now let's import the `World` dataset from the `tmap` and explore which parts of the world are requesting the most agriculture-related loans.

```{r}
# Selecting useful parts of World dataset
data("World")
world_data <- World %>%
  select(c("iso_a3", "continent", "economy", "gdp_cap_est", "HPI", "geometry")) %>%
  rename(iso = iso_a3)

# Merging with Kiva Loans
kiva_world <- inner_join(kiva_loans_PKs, world_data, by = "iso")
kiva_world_ag <- kiva_world[kiva_world$sector == "Agriculture", ]
```

```{r, warning=FALSE, message=FALSE}
# Performing group_by aggregation on Country
agriculture_by_country <- kiva_world_ag %>%
  group_by(country, iso, economy, gdp_cap_est, HPI, geometry) %>%
  summarise("total_agriculture_loans_usd" = sum(funded_amount))

agriculture_by_region <- kiva_world_ag %>%
  group_by(continent) %>%
  summarise("total_agriculture_loans_usd" = sum(funded_amount))

head(agriculture_by_country)
```

<br>

## Research Question 4 <br>

What Is The Average Loan Amounts Per Gender in Each Region?

A side by side bar graph was created to visualise the mean loan amounts per gender in each region. It's worth mentioning that 4,221 sets of data with missing gender information were excluded from the dataset before creating the graph. 

```{r, warning = FALSE, message = FALSE}

## Filtering out data which does not have either Male or Females in borrower_genders column. 
genders_clean <- kiva_loans %>% 
  filter(!is.na(borrower_genders) & borrower_genders %in% c("male", "female")) 

## Finding the mean funded amount for genders dependent on country 
summary_aggregated <- genders_clean %>% 
  group_by(country, borrower_genders) %>% 
  summarize(mean_funded_amount = mean(funded_amount)) 

## Making columns and separating data 
summary_aggregated <- summary_aggregated %>% 
  mutate(
    males = ifelse(borrower_genders == "male", mean_funded_amount, 0), 
    females = ifelse(borrower_genders == "female", mean_funded_amount, 0)
  ) 

## Synthesizing data 
synthesized_data <- summary_aggregated %>% 
  group_by(country) %>% 
  summarize(male = sum(males), female = sum(females)) 

## Renaming a column 
synthesized_data <- rename(synthesized_data, c("Country" = "country")) 
countries_clean <- rename(countries_clean, c("Country" = "country")) 

## Combining male and female data with countries data 
countries_clean <- inner_join(countries_clean, synthesized_data, by = "Country") 

## Regions Only 
regions_data <- countries_clean %>% 
  group_by(region) %>% 
  summarize(male = sum(male), female = sum(female)) 

## Making it look nice 
regions_data <- regions_data %>% 
  gather(key = "gender", value = "value", male, female) 

## Plotting Side by Side Graph 
ggplotly(
  ggplot(data = regions_data, aes(x = region, y = value, fill = gender)) 
  + geom_bar(stat = "identity", position = "dodge") 
  + scale_fill_manual(values = c("male" = "black", "female" = "grey")) 
  + labs(x = "\nRegions", y = "Mean Loan Amount\n") 
  + ggtitle("Mean Loan Amount Per Gender in Regions") 
  + theme(
    plot.title = element_text(hjust = 0.5), 
    axis.title.x = element_text(colour = "black"), 
    axis.title.y = element_text(colour = "black")
  ) 
  + theme(axis.text.x = element_text(angle = 45, hjust = 1))
)

```

Based on the dataset, it was found that for every 1 male borrower, there were 3.16 female borrowers. This is reflected in the graph, as females had a higher mean loan amount per gender in 5 out of 9 regions. The region of Latin America and the Caribbean stood out as having the largest differential gap in mean loan amounts between males and females among all the other regions. 

This can be attributed to the high levels of gender inequality in this region, as concluded in a study conducted by the Inter-American Development Bank (IDB) titled “An Unequal Olympiad: Gender Equity in Latin American and Caribbean Companies” (Ines et al. 2021). The study found that women hold only 15% of management positions, 35% of women in the workforce have access to advanced technologies, and 6 out of 10 companies do not provide any type of maternity leave beyond what is determined by law. Highlighting the need for further research and action to address gender inequality in this region, and the potential impact it has on loan amounts.


# References

Style: APA 

https://data.worldbank.org/indicator/NY.GDP.PCAP.CD?end=2021&name_desc=false&start=1960&view=chart

>>>>>>> 5f53c7ebc3744ac36a32f637219ae061d90c04b8
Intes, B.A., Angeles, B.A., Andrea, M.S., Magdalena, B., Natalia, S.A.T., Stephanie, O.C. (2021). Una olimpíada desigual: la equidad de género en las empresas latinoamericanas y del Caribe. http://dx.doi.org/10.18235/0003427