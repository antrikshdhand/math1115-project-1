---
title: "An investigation into the spread of Kiva loans around the world"
author: "SIDs: 510415022, 500459111, 500463613 and 500545399"
subtitle: "For MATH1115: Project 1"
date: "University of Sydney | January 2022"
bibliography: references.bib

output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    #This will allow you to insert icons in your document, thanks to [Font Awesome](http://fontawesome.io).
    toc: true
    toc_depth: 3
    toc_float: true
    code_folding: hide
---

<br>

# Executive Summary

Clear, interesting summary of the main insights from the report. [Max 100 words].

<br>

# Full Report

```{r}
library(tidyverse)
library(janitor)
library(plotly)
```


## Initial Data Analysis (IDA)

Origin of data cited and critically assessed, including reliability and limitations. Any necessary data wrangling has occurred for the research questions undertook, with a brief rationale. Propose potential interested stakeholders of your research questions and project. [Max 300 words]

The GDP data set used in research question one is from the World Bank, it currently contains global annual GDP data for 266 countries from as early as 1960 (depending on the country) to 2021. The data itself is reliable as it is collected and consolidated by the world bank, which is a global organisation run by the United Nations. The onyl limitation is some of the country names don't exactyl match the ones in the kiva dataset. 

https://data.worldbank.org/indicator/NY.GDP.MKTP.CD?fbclid=IwAR29u5holItcdJImridwqJs2rhiEvhytJR35XB6dSAoYRqIRUEJ9MEfDtRo

Summary:

- The data cames from ...
- The data is/is not valid because ...
- Possible issues include ...
- Each row represents ...
- Each column represents ...

<br>

## IQ 1: Is there a correlation between a country's GDP and the total sum of Kiva loans?

To answer this question an interactive scatter plot was created using the below code. Hovering above a data point will bring up the country's name, its GDP and its total loan sum. Both axis are logarithmic with a base of 10 in order to spread out the data.

```{r, warning = FALSE, message = FALSE}
kiva_loans <- read_csv("data/kiva_loans.csv") # read in Kiva data
world_gdp <- read_csv("data/world_gdp.csv") # read in GDP data 
kiva_loans_country <- kiva_loans %>%
  rename(Country = "country") %>% 
  group_by(Country) %>% # aggregates by country
  summarise(sum(loan_amount)) # calculates the total loan sum per country and creates a new data frame

world_gdp <- world_gdp %>% 
  rename(Country = "Country Name") %>% # renames country
   mutate(Country = recode(Country, `Congo, Rep.` = "Congo", `Congo, Dem. Rep.` = "The Democratic Republic of the Congo", `Cote d'Ivoire` = "Cote D'Ivoire", `Egypt, Arab Rep.` = "Egypt", `Kyrgyz Republic` = "Kyrgyzstan", `Lao PDR` = "Lao People's Democratic Republic", `Myanmar` = "Myanmar (Burma)", `West Bank and Gaza` = "Palestine", `St. Vincent and the Grenadines` = "Saint Vincent and the Grenadines", `Turks and Caicos Islands` = "Turkey", `Virgin Islands (U.S.)` = "Virgin Islands", `Yemen, Rep.` = "Yemen")) %>% # renames country names that differ from the kiva data set
  group_by(Country) %>% # aggregates by country
  rename(Country_GDP = "2015") %>% # renames country GDP
  summarise(Country_GDP) # creates a new data frame

kiva_loans_world_gdp <- merge(kiva_loans_country, world_gdp, all.x = T, all.y = F) # merges the two data frames
colnames(kiva_loans_world_gdp) <- c("Country", "Loan Sum", "GDP") # renames the columns

plot_kiva_loans_world_gdp <- ggplot(kiva_loans_world_gdp, aes(x = `GDP`, y = `Loan Sum`, Country = `Country`)) +
  geom_point(colour  = "darkgreen") + 
  scale_x_continuous(trans = 'log10') +
  scale_y_continuous(trans = 'log10') +
  labs(x = "GDP (USD)", y = "Sum of Loans (USD)", title = "Exponetial Scatter plot for the Sum of Kiva loans against the GDP for each Country")
ggplotly(plot_kiva_loans_world_gdp)
```
The GDP data in the scatter plot above is made up of GDP data from 2015. This was done to make a better comparison with the kiva loan data which has data from 2013 to 2017. GDP and Loan Sum appear to have a slight negative correlation with countries with a relatively low accounting for the majority of loaned money.

## Research Question 2

Insert text and analysis. 

Summary: 

## IQ 3: A deeper look into the agriculture sector

As most Kiva funding went towards agriculture-related activities (as found by IQ 2), it may be interesting to explore this sector further.

```{r}
# filtering all agriculture-related Kiva loans 
agriculture_loans <- kiva_loans[kiva_loans["sector"] == "Agriculture", ]
head(agriculture_loans)
```

Let's explore where most of these agriculture-related loans are going.

```{r}
# Creating our own 'Countries' dataset from two other datasets
countries <- read_csv("data/countries.csv")
countries_clean <- countries %>%
  clean_names() %>%
  subset(select = c("country", "region", "population", "pop_density_per_sq_mi", 
                    "infant_mortality_per_1000_births", "gdp_per_capita", "literacy_percent",
                    "phones_per_1000", "arable_percent", "crops_percent"))
iso_codes <- read_csv("data/iso_codes.csv") %>%
  rename(name = `English short name lower case`) %>%
  rename(country_code = `Alpha-2 code`) %>%
  subset(select = c("name", "country_code")) # only need the 3-digit code

iso_countries <- merge(countries_clean, iso_codes, by.x = "country", by.y = "name")
head(iso_countries)
```

```{r}
# Merging with agriculture loans
kiva_countries <- merge(agriculture_loans, iso_countries, by.x = "country_code", by.y = "country_code")

# Grouping agriculture loans by region
agriculture_by_region <- kiva_countries %>% 
  group_by(region.y) %>%
  summarise(sum(loan_amount))


```

<br>

# References

Style: APA 

<br>