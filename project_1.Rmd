---
title: "MATH1115: Project 1"
author: "Antriksh - 510415022 | Boris - 500463613 | Vishesh - 500545399 | Alex - 500459111"
subtitle: "An Investigation into Kiva Crowdfunding data"
date: "University of Sydney | MATH1115 | JAN 2023"
# You can change the title, subtitle, author etc.
# if you do not want a subtitle, author, or date just delete or comment # the the line!
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    #This will allow you to insert icons in your document, thanks to [Font Awesome](http://fontawesome.io).
    #You will find an examples below.
    # If you are knitting your document but not connected to the internet, place a "#" in front of the css line above with the font-awesome.min.css line to comment it out. This will let you knit the document in draft form until you connect again and knit the final. Note that when you do this some elements will be missing from the knitted slides. 
    toc: true
    #This adds a Table of Contents (toc).
    toc_depth: 3
    #This controls the number of subheadings included in the toc.
    toc_float: true
    #This allows toc to update relative to your location as you scroll down the html page.
    code_folding: hide
    #code_folding can be changed to "hide"" if you want the all your code to be collapsed when you open the document
    
    # More information: http://rmarkdown.rstudio.com/html_document_format.html
---

<br>

# Executive Summary
- The aim of this report is to ...
- The main discoveries are ...

<br>

# Full Report

## Initial Data Analysis (IDA)

The data set used to generate our research questions comes from the Kiva Crowdfunding, ‘Data science for good’ open data initiative. Kiva (2023) is a service aimed at providing small loans to the worlds unbanked population. This initiative was created so members of the public could help Kiva better understand the levels of poverty in areas where they had active loans (Kaggle, 2018). The data has a CC0: Public Domain licence meaning that we are free to use and distribute the data as we wish (Creative Commons, 2023) The data has been edited by a community member called ‘mfab’ which may reduce the reliability of the data, however as Kiva is the ‘Owner’ it is assumed that they have approved this editor and that the data remains reliable. The omission of the COVID-19 pandemic from the data is a notable limitation as the pandemic may have created changes in trends which would have made for interesting research. 

The world_gdp data is reliable as it is collected and consolidated by the world bank, which is a global organisation run by the United Nations. It has an Open Database License, which allows users to copy, modify and distribute data. The only limitation is some of the country names don't match the ones in the Kiva dataset and the iso codes are in the three letter format rather than the two letter one used in the Kiva dataset. Some wrangling of data was required in order to use the datasets. Most wrangling of data was grouping to isolate variables for comparison. Functions such as mutate, rename and merge were also used to change variable values, rename columns and merge datasets together for the generation of our figures. 

Potential stakeholders for this report would be those looking to potentially loan out money to others through services like Kiva, that want to know where their money is being sent and how it is being used. This report is a general overview about the types of people that apply for the loans, how much their loans are and how the loaned money is used. 

## Data setup


```{r, message = 'FALSE'}
library(tidyverse)
library(tmap)
library(countrycode)
library(janitor)
library(plotly)
```


```{r}
kiva_loans <- read_csv("data/kiva_loans.csv") # read in Kiva data
```

Let's create our own country dataset.

Sources: 
- https://www.kaggle.com/datasets/juanumusic/countries-iso-codes
- https://www.kaggle.com/datasets/fernandol/countries-of-the-world

NEED TO ELABORATE ON THESE SOURCES...

```{r}
# Creating our own 'Countries' dataset from two other datasets
countries <- read_csv("data/countries.csv")
countries_clean <- countries %>%
  clean_names() %>%
  subset(select = c("country", "region"))

iso_codes <- read_csv("data/iso_codes.csv") %>%
  rename(name = `English short name lower case`) %>%
  rename(country_code = `Alpha-2 code`) %>%
  subset(select = c("name", "country_code")) # only need the 3-digit code

iso_countries <- merge(countries_clean, iso_codes, by.x = "country", by.y = "name")
head(iso_countries)
```

```{r}
# Merging Countries dataset with Kiva loans

kiva_countries <- merge(kiva_loans, iso_countries, by.x = "country_code", by.y = "country_code")
```

## Research Question 1
##Is there are correlation between a country's GDP per capita and its total loan sum?

To Answer this question an interactive scatter plot was drawn using the below code. Hovering above a data point will bring up the country's name, its GDP per capita and its total loan sum. Both axis are logarithmic with a base of 10 in order to spread out the data so relationships can be drawn.
```{r, warning = FALSE, message = FALSE}
world_gdp <- read_csv("data/world_gdp.csv", skip = 4) # reads the file "world_gdp.csv" and assigns it as "world_gdp"

gdp_cleaned <- world_gdp %>% 
  rename(country = "Country Name") %>% # renames country
  mutate(country = recode(country, `Congo, Rep.` = "Congo", `Congo, Dem. Rep.` = "The Democratic Republic of the Congo", `Cote d'Ivoire` = "Cote D'Ivoire", `Egypt, Arab Rep.` = "Egypt", `Kyrgyz Republic` = "Kyrgyzstan", `Lao PDR` = "Lao People's Democratic Republic", `Myanmar` = "Myanmar (Burma)", `West Bank and Gaza` = "Palestine", `St. Vincent and the Grenadines` = "Saint Vincent and the Grenadines", `Turks and Caicos Islands` = "Turkey", `Virgin Islands (U.S.)` = "Virgin Islands", `Yemen, Rep.` = "Yemen")) %>% # renames country names that differ from the kiva data set %>% 
  group_by(country) %>% # aggregates by country
  rename(country_gdp = "2015") %>% # renames country GDP
  summarise(country_gdp) # creates a new data frame

kiva_gdp <- kiva_loans %>%
  group_by(country) %>%
  summarise(sum(loan_amount))

kiva_gdp <- merge(kiva_gdp, gdp_cleaned, all.x = T, all.y = F) # merges the two data frames

colnames(kiva_gdp) <- c("Country", "Loan Sum", "GDP per Capita")

plot_kiva_gdp <- ggplot(kiva_gdp, aes(x = `GDP per Capita`, y = `Loan Sum`, country = `Country`)) +
  geom_point(colour  = "magenta") + 
  scale_x_continuous(trans = 'log10') +
  scale_y_continuous(trans = 'log10') +
  labs(x = "GDP pe capita (USD)", y = "Sum of Loans (USD)", title = "The total sum of Kiva loans against the GDP per capita for each country")
ggplotly(plot_kiva_gdp)
```
The GDP data in the scatter plot above utilities GDP data from 2015. This was done to make a better comparison with the kiva loan data which has data from 2014 to 2017. The plot has clustering towards the top left, which implies that countries with a lower GDP per capita account for the majority of loaned money. There is however no direct linear correlation between loaned amount and GDP per capita. It is important to note that countries that have requested the most money tend to be developing countries with relatively low GDP. Which leads into the next research question which looks into how the funding is distributed per sector. 

## Research Question 2

What is the distribution of funding between the Kiva designated sectors?

```{r}
 kiva_loans %>%
  group_by(sector) %>%
  summarise(total_funding = signif(sum(funded_amount)*10^(-6),5)) %>%
  ggplot(aes(x=fct_reorder(sector, desc(total_funding)), y = total_funding)) + geom_col() +  # Represents the data as a side by side bar chart with colour
  labs(x = "Sector", y = "Total Funding (Million USD)", title = 'Total Kiva funding per Sector') +
  theme_classic() + #Classic theme just an example or an idea of what can be done and how
  geom_text(aes(label = total_funding), vjust = -0.5, size = 2) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust=0.4))
```

Reviewing the above bar plot, we can see that agriculture, food and retail are by far the most funded Kiva sectors. For context, these three sectors receive double the amount of funding as the remaining 12. Interestingly, if we review the ‘Use’ column of the data frame it can also be observed that many loans categorised for retail are in fact loans to purchase food items such as Salt, Rice, Flour etc.

```{r}
library(gt)
kiva_loans %>%
  filter(sector == 'Food') %>%
  select(use) %>%
  slice(1:10) %>% 
  gt()

```


The conclusions drawn from research Q1 inform us that Kiva loans are most typically requested in developing countries with low GDP’s, in these countries access to food is not a given and the creation of a constant food supply may be able to lift some out of poverty. In his 2015 report, Robert Townsend states that for the worlds poorest, growth in agriculture is two to four times more effective in raising living standards than growth in the next closest sector. This fact can create a win-win scenario for all stakeholders. So long as the loan is used wisely the fundees can create more value than they initially borrowed, and funders can see their investment amount to more than its dollar value. As such, it is not surprising that agriculture loans make up 27% of all Kiva loans.  

This will need to be formatted properly 

Townsend, R. (2015). Ending poverty and hunger by 2030 : an agenda for the global food system. Washington DC. Retrieved from https://documents.worldbank.org/en/publication/documents-reports/documentdetail/700061468334490682/ending-poverty-and-hunger-by-2030-an-agenda-for-the-global-food-system. 

## Research Question 3

Insert text and analysis. 

```{r}
# Grouping agriculture loans by region
agriculture_by_region <- kiva_countries %>% 
  group_by(region = region.y) %>%
  summarise(total_loans_sum = sum(loan_amount))
```

Summary: 

```{r}
ggplot(agriculture_by_region, aes(x = region, y = total_loans_sum)) +
  geom_col(stat = "identity") +
  theme(axis.text.x = element_text(angle=90),
          axis.text.y = element_text(angle=90))
```


<br>

## Research Question 4 <br>

What Is The Average Loan Amounts Per Gender in Each Region?


```{r, warning = FALSE, message = FALSE}

## Filtering out data which does not have either Male or Females in borrower_genders column. 

genders_clean <- kiva_loans %>% 

  filter(!is.na(borrower_genders) & borrower_genders %in% c("male", "female")) 

  

## Finding the mean funded amount for genders dependent on country 

summary_aggregated <- genders_clean %>% 

  group_by(country, borrower_genders) %>% 

  summarize(mean_funded_amount = mean(funded_amount)) 

   

## Making columns and separating data 

summary_aggregated <- summary_aggregated %>% 

  mutate(males = ifelse(borrower_genders == "male", mean_funded_amount, 0), females = ifelse(borrower_genders == "female", mean_funded_amount, 0)) 

  

## Synthesizing data 

synthesized_data <- summary_aggregated %>% 

  group_by(country) %>% 

  summarize(male = sum(males), female = sum(females)) 

  

## Renaming a column 

synthesized_data <- rename(synthesized_data, c("Country" = "country")) 

countries_clean <- rename(countries_clean, c("Country" = "country")) 

  

## Combining male and female data with countries data 

countries_clean <- inner_join(countries_clean, synthesized_data, by = "Country") 

  

## Regions Only 

regions_data <- countries_clean %>% 

  group_by(region) %>% 

  summarize(male = sum(male), female = sum(female)) 

  

## Making it look nice 

regions_data <- regions_data %>% 

  gather(key = "gender", value = "value", male, female) 

  

## Plotting Side by Side Graph 

ggplotly(ggplot(data = regions_data, aes(x = region, y = value, fill = gender)) + 

           geom_bar(stat = "identity", position = "dodge") + 

           labs(x = "\nRegions", y = "Mean Loan Amount\n", title = "\n Mean Loan Amount Per Gender in Regions\n") + 

           theme(plot.title = element_text(hjust = 0.5), 

                 axis.title.x = element_text(face = "bold", colour = "red", size = 10), 

                 axis.title.y = element_text(face = "bold", colour = "red", size = 10)) + 

                 theme(axis.text.x = element_text(angle = 45, hjust = 1))) 





```


# References

Style: APA 

<br>
