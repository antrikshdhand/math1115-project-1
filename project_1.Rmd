---
title: "MATH1115: Project 1"
author: "Antriksh - 510415022 | Boris - 500463613 | Vishesh - 500545399 | Alex - 500459111"
subtitle: "An Investigation of Kiva Crowdfunding data"
date: "University of Sydney | MATH1115 | JAN 2023"
# You can change the title, subtitle, author etc.
# if you do not want a subtitle, author, or date just delete or comment # the the line!
output:
  html_document:
    fig_caption: yes
    number_sections: yes
    self_contained: yes
    theme: flatly
    # Other themes can be found at: https://bootswatch.com/
    css: 
      - https://use.fontawesome.com/releases/v5.0.6/css/all.css
    #This will allow you to insert icons in your document, thanks to [Font Awesome](http://fontawesome.io).
    #You will find an examples below.
    # If you are knitting your document but not connected to the internet, place a "#" in front of the css line above with the font-awesome.min.css line to comment it out. This will let you knit the document in draft form until you connect again and knit the final. Note that when you do this some elements will be missing from the knitted slides. 
    toc: true
    #This adds a Table of Contents (toc).
    toc_depth: 3
    #This controls the number of subheadings included in the toc.
    toc_float: true
    #This allows toc to update relative to your location as you scroll down the html page.
    code_folding: hide
    #code_folding can be changed to "hide"" if you want the all your code to be collapsed when you open the document
    
    # More information: http://rmarkdown.rstudio.com/html_document_format.html
---

<br>

# Executive Summary
- The aim of this report is to ...
- The main discoveries are ...

<br>

# Full Report

## Initial Data Analysis (IDA)

# Initial Data Analysis (IDA)

 - Origin of data reviewed and critically assessed incl reliability and limitations
  - Kiva Data (~ 100 words)
  - World Data (~50)
 - Data wrangling necessary and rational (~75)
 - Potential interested stakeholders (~75)

```{r, message = 'FALSE'}
loan_data <- read.csv("data/kiva_loans.csv")
library(tidyverse)
library(tmap)
library(countrycode)
```

The GDP data set used in research question one is from the World Bank, it currently contains global annual GDP data for 266 countries from as early as 1960 (depending on the country) to 2021. The data itself is reliable as it is collected and consolidated by the world bank, which is a global organisation run by the United Nations. The onyl limitation is some of the country names don't exactyl match the ones in the kiva dataset. 

https://data.worldbank.org/indicator/NY.GDP.MKTP.CD?fbclid=IwAR29u5holItcdJImridwqJs2rhiEvhytJR35XB6dSAoYRqIRUEJ9MEfDtRo

## Research Question 1
##Is there are correlation between a Country's GDP and its total loan Sum?

To Answer this question an interactive scatter plot was created using the below code. Hovering above a data point will bring up the country's name, its GDP and its total loan Sum. Both axis are logarithmic with a base of 10 in order to spread out the data.
```{r, warning = FALSE, message = FALSE}
library(tidyverse) # loads the tidyverse package 
library(janitor) # loads the janitor package 
library(plotly) # loads the plotly package 

kiva_loans <- read_csv("data/kiva_loans.csv") # reads the file "kiva_loans.csv" and assigns it as "kiva_loans"
world_gdp <- read_csv("data/world_gdp.csv", skip = 4) # reads the file "world_gdp.csv" and assigns it as "world_gdp"

kiva_loans <- kiva_loans %>%
  rename(Country = "country") %>% # renames country
  group_by(Country) %>% # aggregates by country
  summarise(sum(loan_amount)) # calculates the total loan sum per country and creates a new data frame

world_gdp <- world_gdp %>% 
  rename(Country = "Country Name") %>% # renames country
   mutate(Country = recode(Country, `Congo, Rep.` = "Congo", `Congo, Dem. Rep.` = "The Democratic Republic of the Congo", `Cote d'Ivoire` = "Cote D'Ivoire", `Egypt, Arab Rep.` = "Egypt", `Kyrgyz Republic` = "Kyrgyzstan", `Lao PDR` = "Lao People's Democratic Republic", `Myanmar` = "Myanmar (Burma)", `West Bank and Gaza` = "Palestine", `St. Vincent and the Grenadines` = "Saint Vincent and the Grenadines", `Turks and Caicos Islands` = "Turkey", `Virgin Islands (U.S.)` = "Virgin Islands", `Yemen, Rep.` = "Yemen")) %>% # renames country names that differ from the kiva data set
  group_by(Country) %>% # aggregates by country
  rename(Country_GDP = "2015") %>% # renames country GDP
  summarise(Country_GDP) # creates a new data frame

kiva_loans_world_gdp <- merge(kiva_loans, world_gdp, all.x = T, all.y = F) # merges the two data frames
colnames(kiva_loans_world_gdp) <- c("Country", "Loan Sum", "GDP") # renames the columns

plot_kiva_loans_world_gdp <- ggplot(kiva_loans_world_gdp, aes(x = `GDP`, y = `Loan Sum`, Country = `Country`)) +
  geom_point(colour  = "darkgreen") + 
  scale_x_continuous(trans = 'log10') +
  scale_y_continuous(trans = 'log10') +
  labs(x = "GDP (USD)", y = "Sum of Loans (USD)", title = "Exponetial Scatter plot for the Sum of Kiva loans against the GDP for each Country")
ggplotly(plot_kiva_loans_world_gdp)
```
The GDP data in the scatter plot above is made up of GDP data from 2015. This was done to make a better comparison with the kiva loan data which has data from 2013 to 2017. GDP and Loan Sum appear to have a slight negative correlation with countries with a relatively low accounting for the majority of loaned money.

## Research Question 2

What is the distribution of funding between the Kiva designated sectors?

```{r}
loan_data %>%
  group_by(sector) %>%
  summarise(total_funding = signif(sum(funded_amount)*10^(-6),5)) %>%
  ggplot(aes(x=fct_reorder(sector, desc(total_funding)), y = total_funding)) + geom_col() +  # Represents the data as a side by side bar chart with colour
  labs(x = "Sector", y = "Total Funding (Million USD)", title = 'Total Kiva funding per Sector') +
  theme_classic() + #Classic theme just an example or an idea of what can be done and how
  geom_text(aes(label = total_funding), vjust = -0.5, size = 2) +
  theme(axis.text.x = element_text(angle = 60, vjust = 0.5, hjust=0.4))
```

Reviewing the above bar plot, we can see that agriculture, food and retail are by far the most funded Kiva sectors. For context, these three sectors receive double the amount of funding as the remaining 12. Interestingly, if we review the ‘Use’ column of the data frame it can also be observed that many loans categorised for retail are in fact loans to purchase food items such as Salt, Rice, Flour etc.

```{r}
library(gt)
loan_data %>%
  filter(sector == 'Food') %>%
  select(use) %>%
  slice(1:10) %>% 
  gt()

```


The conclusions drawn from research Q1 inform us that Kiva loans are most typically requested in developing countries with low GDP’s, in these countries access to food is not a given and the creation of a constant food supply may be able to lift some out of poverty. In his 2015 report, Robert Townsend states that for the worlds poorest, growth in agriculture is two to four times more effective in raising living standards than growth in the next closest sector. This fact can create a win-win scenario for all stakeholders. So long as the loan is used wisely the fundees can create more value than they initially borrowed, and funders can see their investment amount to more than its dollar value. As such, it is not surprising that agriculture loans make up 27% of all Kiva loans.  

This will need to be formatted properly 

Townsend, R. (2015). Ending poverty and hunger by 2030 : an agenda for the global food system. Washington DC. Retrieved from https://documents.worldbank.org/en/publication/documents-reports/documentdetail/700061468334490682/ending-poverty-and-hunger-by-2030-an-agenda-for-the-global-food-system. 

## Research Question 3

Insert text and analysis. 

Summary: 

<br>

## Research Question 4

# References

Style: APA 

<br>


```{r, echo = FALSE, warning = FALSE, message = FALSE}
library(tidyverse) # loads the tidyverse package 
library(janitor) # loads the janitor package 
library(plotly) # loads the plotly package 

kiva_loans <- read_csv("data/kiva_loans.csv") # reads the file "kiva_loans.csv" and assigns it as "kiva_loans"
world_gdp <- read_csv("data/world_gdp.csv") # reads the file "world_gdp.csv" and assigns it as "world_gdp"

kiva_loans <- kiva_loans %>%
  rename(Country = "country") %>% # renames country
  group_by(Country) %>% # aggregates by country
  summarise(sum(loan_amount)) # calculates the total loan sum per country and creates a new data frame

world_gdp <- world_gdp %>% 
  rename(Country = "Country Name") %>% # renames country
  group_by(Country) %>% # aggregates by country
  rename(Country_GDP = "2015") %>% # renames country
  summarise(Country_GDP) # creates a new data frame

kiva_loans_world_gdp <- merge(kiva_loans, world_gdp, all.x = F, all.y = F) # merges the two data frames
kiva_loans_world_gdp <- kiva_loans_world_gdp %>% 
  rename(Country_Loan_Sum = "sum(loan_amount)") # renames sum(loan_amount) to Country_Loan_Sum for clarity in the interative graph

plot_kiva_loans_world_gdp <- ggplot(kiva_loans_world_gdp, aes(x = `Country_GDP`, y = `Country_Loan_Sum`, Country = `Country`)) +
  geom_point(colour  = "purple") + 
  labs(x = "Country's GDP", y = "Sum of Loans per Country", title = "Sum of Kiva loans per country against the country's GDP")
ggplotly(plot_kiva_loans_world_gdp)
```

